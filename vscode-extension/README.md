# Codex History Manager

在 VS Code 内直接浏览、预览并管理你的 Codex 历史对话记录。

## 功能特性

一个用于在 VS Code 中浏览和管理 Codex 历史对话的扩展。

## ✨ 功能特性

### 核心功能
- 📚 **浏览对话历史**：在 Webview 或侧边栏中查看所有 Codex 对话历史
- 👁️ **对话预览**：查看对话的详细内容
- 🗑️ **删除对话**：删除不需要的对话记录
- 📝 **添加备注**：为对话添加自定义备注
- 📦 **归档支持**：自动识别并标记归档会话，带有醒目的视觉区分

### 删除体验优化
- ⌨️ **Delete 键删除**：选中会话后按 Delete 键快速删除
- 🎯 **智能选择**：删除后自动选中下一条会话
- 🗑️ **批量删除空会话**：一键删除所有空会话，释放空间

### 会话管理
- 🔄 **重建索引**：自动扫描 `sessions` 和 `archived_sessions` 目录
- 🔍 **搜索功能**：快速查找特定对话
- 📌 **置顶功能**：标记重要对话
- ▶️ **终端恢复**：一键在终端中恢复会话

### 智能显示
- 💬 **智能标题**：自动提取第一条用户消息作为会话标题
- 🤖 **过滤系统提示**：自动跳过 Agents.MD 和环境上下文
- 📋 **清晰展示**：会话 ID 作为副标题，易于识别
- 🎨 **归档标识**：归档会话带有 "📦 归档" 徽章和特殊样式

## 🚀 使用方法

### 打开历史管理器
1. 使用命令面板（Ctrl/Cmd + Shift + P）
2. 输入 "Codex History: 打开管理器"
3. 或点击侧边栏的 Codex History 图标

### 管理对话
- **查看对话**：点击列表中的对话查看详细内容
- **删除对话**：选中对话后按 Delete 键，或点击"删除会话"按钮
- **批量删除**：点击"批量删除空会话"按钮
- **恢复对话**：点击"在终端恢复 ▶️"或"复制 Resume 命令"
- **添加备注**：在预览区输入备注并保存

### 重建索引
如果会话列表不完整，使用"Codex History: 重建索引"命令重新扫描所有会话文件。

## ⚙️ 配置

### 自定义 Codex Home 路径
```json
{
  "codexHistory.codexHome": "/path/to/your/.codex"
}
```

默认路径: `~/.codex`

## 📋 更新日志

### v0.0.8-beta.1 (开发中) - 2025-11-20

#### ⌨️ 键盘快捷方式
- 备注输入支持 Enter/Ctrl+Enter 快捷保存

#### 🔄 自动刷新改进
- 删除会话后自动刷新侧边栏
- 批量删除后自动刷新侧边栏
- 保存备注后自动刷新侧边栏

#### 🛠️ Resume 命令修复
- 修复 resume 命令格式，正确提取 UUID（如：`codex resume 019a6dec-b4b4-75e2-a33f-9e077e7ad797` 而非完整 session ID）

#### 🐛 Bug 修复
- 修复批量删除只扫描前 50 个会话的问题，现在会扫描所有会话（limit: 1000）
- 修复模板字符串中 `</script>` 标签导致的解析错误，转义为 `<\/script>`
- 修复批量删除使用 Webview `confirm` 对话框导致的错误，改用 VS Code 原生确认对话框
- 修复侧边栏只显示 20 个会话的限制，提升到 1000
- 修复归档会话预览加载问题，`findSessionFile` 现在会同时搜索 `sessions` 和 `archived_sessions` 目录
- 修复 "Invalid Date" 显示问题，确保时间戳存储为数字
---

### 从 v0.0.7 到 v0.0.38 的主要改进总结

#### 🗑️ 删除体验优化
- ⌨️ 支持 Delete 键快速删除选中的会话
- 🎯 删除后自动选中下一条会话（或上一条，如果是最后一条）
- 🗑️ 批量删除空会话功能，一键清理所有空会话

#### 🎨 UI/UX 改进
- 归档会话带有 "📦 归档" 橙色徽章
- 左侧橙色边框和浅橙色背景标识归档会话
- 改进的会话列表样式和备注显示
- 清理多行标题，移除换行符和多余空格
- 标题自动截断至 80 个字符
- 空会话显示为 "(空会话)"
- 移除 Webview/侧边栏会话显示限制（提升至 1000）

#### 💬 智能标题提取
- 自动提取第一条用户消息作为会话标题
- 正确解析三种不同的 JSON 结构
- 提取 `## My request for Codex:` 避免包含 IDE 上下文
- 自动过滤 Agents.MD 和环境上下文

#### 📦 归档会话支持
- 自动扫描 `archived_sessions` 目录
- 识别并标记归档会话
- 归档会话带有特殊视觉标识

---

### 从 v0.0.7 到 v0.0.8 的主要改进总结

#### 📦 归档会话支持
- 自动扫描 `archived_sessions` 目录
- 归档会话带有 "📦 归档" 橙色徽章和特殊样式
- 修复归档会话预览加载问题

#### 💬 智能标题提取
- 自动提取第一条用户消息作为会话标题
- 过滤系统提示词（Agents.MD、环境上下文等）
- 清理多行标题，移除换行符
- 空会话显示为 "(空会话)"
- 修复时间戳格式问题
- 移除会话显示限制（提升至 1000）

#### 🗑️ 删除体验优化
- 支持 Delete 键快速删除
- 删除后自动选中下一条会话
- 批量删除空会话功能
- 修复批量删除只扫描部分会话的问题

#### 🔄 自动刷新
- 删除、批量删除、备注保存后自动刷新侧边栏

#### 🛠️ 功能修复
- 修复 resume 命令格式（提取 UUID）
- 修复 Webview 脚本解析错误
- 修复批量删除确认对话框错误
- 修复侧边栏显示数量限制

#### ⌨️ 键盘快捷方式
- Delete 键删除会话
- Enter/Ctrl+Enter 保存备注

---

## ❓ 常见问题

### Q: 为什么有些会话显示为"(空会话)"？
A: 这些是只包含环境上下文但没有实际用户消息的会话，通常是被取消的或立即关闭的会话。

### Q: 归档会话和普通会话有什么区别？
A: 归档会话存储在 `archived_sessions` 目录中，由官方 Codex 插件管理。它们会带有特殊的橙色标识。

### Q: 如何批量删除空会话？
A: 点击工具栏中的"批量删除空会话"按钮，确认后即可删除所有空会话。

### Q: 删除后如何自动选择下一条？
A: 删除会话后，扩展会自动选中下一条会话（如果是最后一条，则选中上一条）。

## 📝 许可证

MIT
---
**Enjoy coding with Codex!**
